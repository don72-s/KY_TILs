# UI 연동 With MVC

ui는 매우 많은 요소를 가지고 상호작용을 하는 만큼 최적화할 여지가 많고 따라서 최적화가 매우 중요하다.

이를 위해 고안된 패턴이 mvc패턴이다.

어떤 패턴인지 한번 살펴보도록 하자.

<br>

## 값과 출력의 동기화

ui에 값을 전달하는 방법으로 보통 값을 출력하게 된다.

하지만, 대상인 값이 알게 모르게 수정되고, ui에 전달을 놓치게 된다면 값과 출력이 달라질 수 있다.

그렇다면 해당 값의 일관성을 보장할 수 있는 방법에는 어떤 방법이 있을까?
<br>

## 모델과 뷰 그리고 컨트롤러

mvc 패턴은 모델 / 뷰 / 컨트롤러의 이니셜을 따온 패턴이다.

왜 이런 이름을 가지게 되었냐고 한다면 모든 요소들을 3가지 영역으로 분류해서 관리하는 역할을 하기 때문이다.

- 모델 : 그저 값을 가지고 있는 역할을 한다. 모든 연산과 출력은 모델에 있는 값을 기반으로 이루어진다.

- 뷰 : UI의 역할을 하며 모델에 있는 값을 참고하여 화면에 출력하는 역할을 한다.

- 컨트롤러 : 게임 로직을 담당하며, 지금까지 해온 내부연산을 하는 부분이다. 출력할 값에 변화가 있는 경우, 모델의 값을 수정한다.

<br>

### 기본 구조

mvc구조란 사실 모델부분만 제대로 구현한다면, 다른 구조에는 크게 변화가 없을것이다.

유니티에서 가장 기본적인 모델의 코드는 다음과 같이 구성할 수 있다.

```cs
public class HPModel : MonoBehaviour{

    private int hp;
    public HP { 
        get {return hp;}
        set {
             hp = value;
             OnHpChanged?.Invoke(hp);
             }
        }

    public UnityEvent<int> OnHpChanged;

}
```

해당 코드는 hp를 수정하기 위해서는 반드시 유니티 이벤트를 실행시킨다.

즉, HP를 출력하는 UI쪽에서는 정수를 받아 출력하는 함수를 해당 모델의 유니티 이벤트에 등록해놓는다면 hp의 수치가 변할때마다 UI의 출력값이 바뀌는 구조를 만들 수 있다.

<br>

## 게임과 MVP패턴

mvc패턴은 분명 좋은 패턴이지만, 게임의 특성상 변화값에 기반하는 출력 ui가 엄청나게 많을 것이다. 그렇다면 뷰는 mvc구조의 특성상 값의 변화에 반응하여 출력을 갱신해야 한다.

그럴때마다 뷰는 어느 데이터를 참고하고 갱신할지에 대한 코드가 분리되어 작성될 수 밖에 없다.

이를 개선할 방법이 없을까?

<br>

### C가 아니라 P

기존의 mvc패턴에서는 원형인 상호작용 구조를 가졌었다.

여기서는 컨트롤러가 중계자(Presenter) 역할을 하는 mvp패턴을 고려해볼 수 있다.
뷰가 분리되는 상황을 중계자에 병합하여 뷰가 늘어나는 현상을 방지할 수 있으며,
모델에서의 데이터가 변경된다면 출력이 변경될 뷰를 중계자가 알고있는 구조가 된다.

<hr>

유니티적인 구조로 설명하자면, view스크립트는 다 제거하고 view의 역할은 ui오브젝트 그 자체가 맡게 된다.

원래 있던 view의 코드는 p(c)역할을 하는 로직 코드에 병합시키고, 갱신할 ui를 중계자에 등록해두는 방식이 되는 것이다.


<br>