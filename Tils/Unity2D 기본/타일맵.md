# 타일맵

2D에서 격자형식의 구성을 가지는 게임이라면 타일마다 맵을 찍어주어야 할 것이다.

해당 맵을 전체적으로 그리는 방법도 있겠지만, 레고를 조립하듯이 맵을 그리는 방식이 있다.

이러한 구성인 타일맵에 대해서 알아보자.

<br>

## 타일맵

타일맵이란, 용어 그대로 타일로 이루어진 맵을 의미한다.

기본적인 맵이라고 하면 보통 방바닥에 깔려있는 장판에 그려진 그림으로 볼 수 있고, 타일맵이라고 하면 화장실이나 대리석 바닥을 이루는 같은 크기의 타일로 이루어진 바닥으로 볼 수 있다.

<br>

### 재사용과 조합성

조금만 생각하더라도 규격만 맞다면 맵을 전체적으로 그리는것보다 효율이 좋을 것이다.

또한 맵 배치를 유동적으로 바꾸기도 쉬울것이고, 기본 베이스 스프라이트를 구성하는데에 비용이 덜 들어간다는 장점이 있다.

또한 현실과는 다르게 타일을 사용할만큼 찍어내야하는것이 아닌, 원본을 복사하여 사용하는데에 비용이 거의 들지 않기 때문에 적은 원본 리소스로 매우 많은 조합의 구성요소를 만들 수 있다.

## 타일맵 생성

타일맵을 사용하기 위해서는 스프라이트 아틀라스를 이용하여 타일맵을 구성할 필요가 있다.

이 과정에 대해 천천히 알아보자.

<br>

### 스프라이트 분할하기

기존 스프라이트를 나눌때와 마찬가지로 스프라이트 아틀라스의 모드를 multiple로 바꿔준 뒤, 스프라이트 에디터를 열어준다.

그 뒤 크기와 보정값을 조한 뒤 스프라이트 분할을 마친다.

<br>

### 타일맵 생성하기

타일맵의 구성 스프라이트가 준비되었다면, 이제 이를 배치할 수 있도록 만드는 일이 남았다.

2D 에셋 패키지가 다운로드 되어 있다면, 계층뷰에서 우클릭 -> 2D -> Tilemap을 선택하여 종류에 따른 타일맵을 생성할 수 있다.

<hr>

다음으로는 타일맵 요소를 고를 수 있는 창을 열 필요가 있다.

해당 창은 Window -> 2D -> Tilemap Palette를 선택하여 열 수 있다.

다음으로 **Create new palette** 드롭다운을 선택하여 새로운 팔레트를 생성해준 뒤, 만들었었던 스프라이트 타일 파일을 드래그해오면 타일맵 팔레트 준비가 완료된다.

<br>

### 팔래트 내부의 수정

팔래트의 구성요소는 만들었던 스프라이트로 이루어져있지만, 해당 타일들을 조합하여 새로운 타일 요소를 팔레트에 재정의할 수 있다.

단순히 edit버튼을 눌러 활성화된 상황이라면, 팔레트 자체의 구성요소를 수정할 수 있다.

<br>

### 레이어와 복수 타일맵

굳이 하나의 프로젝트에 하나의 타일맵만 존재할 필요는 없다.

따라서 여러개의 타일맵을 사용하게 된다면, 여러개의 레이어를 둔 것과 같은 효과를 줄 수 있다.

이런 방식으로 사용한다면 빈틈이 있는 타일의 뒷부분에 다른 배경을 그리고 싶을 때 여러개의 타일을 조합하여 그릴 수 있게 된다.

물론 해당 레이어들과 타일맵 이외의 요소 [ex) 캐릭터 등] 들의 z축을 조정해서 그리기 순서를 조정해도 괜찮지만, **Sorting Layer**를 이용하면 조금 더 수월할 것이다.

- Sorting Layer를 정의해놓는다면, 상위에 존재하는 Layer에 해당하는 스프라이트들이 먼저 작성되게 된다.

<br>

### 타일맵과 충돌체

타일맵은 배경이다. 따라서 물리적 충돌이나 상호작용이 일어나지 않는다.

하지만, 바닥과 벽 등은 캐릭터와 물리적 상호작용이 이루어져야 한다.

해당 문제는 간단하게 해당 타일맵에 **Tilemap Collider 2D** 컴포넌트를 추가하면 해결된다.

해당 컴포넌트를 추가한다면 해당 컴포넌트를 가지고 있는 tilemap의 타일들은 충돌체(Collider)를 가지게 된다.

<hr>

#### 충돌체와 통합 충돌체

위의 Tilemap Collider 2D는 분명 좋은 해결책이지만 각 타일마다 하나의 충돌체를 가지고 있는 연산상의 문제아닌 문제가 생긴다.

즉, 타일이 20개라면 20개의 충돌체를 가지게 된다.

이러한 문제를 해결하기 위해서 여러가지 충돌체들을 하나로 통합하여 취급하고 싶다면, **Composite Collider 2D** 컴포넌트를 추가할 수 있다.

해당 컴포넌트가 존재하며, 통합을 원하는 충돌체 컴포넌트들에서 **Used By Composite** 항목을 체크하게 된다면 체크된 충돌체들을 묶어서 **하나의 충돌체**로 취급할 수 있도록 해준다.

다만, 자동으로 Rigidbody 2D 컴포넌트가 추가되기 때문에 중력 설정등을 조정해줄 필요가 있다.

<br>

### 충돌체의 조정

이제 충돌체는 만사 오케이!.. 라면 좋겠지만, 또다른 문제가 있다.

경사면 타일을 하나 생성한 뒤, 충돌체의 모양을 확인해보면 그닥 유쾌하지 않은 모양으로 충돌체 경계면이 생성되어 있음을 볼 수 있다.

따라서 충돌체의 모양을 바꿔야 할 필요가 있다.

<hr>

충돌체를 수정하기 위해서는 다시 sprite editer로 돌아갈 필요가 있다.

해당 원본 스프라이트 아틀라스로 돌아가 스프라이터 에디터를 연 뒤, 좌상단의 스프라이트 에디터 항목을 누르면 **Custom Physics Shape** 항목으로 전환할 수 있다.

그리고 수정할 타일을 선택한 뒤, 상단의 **Generate**항목을 선택한다면 해당 타일의 충돌체의 형태를 새로 지정할 수 있다.

<br>

## 2D Tilemap Extra

타일맵 에셋의 기본 기능을 살펴보았다.

여기서 추가로 편리한 기능을 제공하는 확장 기능들도 존재하는데 알아두면 편하므로 한번 간단히 살펴보도록 하자.

<br>

### 게임오브젝트 (프리팹) 그리기

맵 구성에는 배경이나 바닥뿐만이 아닌 오브젝트 요소도 **타일에 맞춰** 그려야 하는 경우도 있다.

이럴 때에는 타일 팔레트에 게임오브젝트(프리팹)을 등록하여 타일맵처럼 그릴 수 있다.

<hr>

title palette로 이동하여 하단의 Default Brush를 **GameObject Brush**로 변경한 뒤, 프리팹을 연결해주면 타일맵처럼 해당 게임 오브젝트를 씬에 추가할 수 있다.

<br>

### 밋밋함 줄이기

브러시의 종류중 **Random Brush**도 존재한다.

문자 그대로 여러종류의 타일들을 지정해놓는다면, 타일을 찍을 때 지정한 목록의 타일들 중 랜덤으로 선택되어 타일이 찍히게 된다.

<br>

### Rule Tile ( 규칙 타일 )

이전에 봤던 9-Slice tile처럼 여러개의 타일 구성이 하나의 묶음으로써 하나의 큰 물체를 이루는것처럼 나타내지는 블록이 있을 수 있다.

이러한 블록들을 하나하나 일일히 그린다면 매우 번거로울 것이다.

이럴때에는 Rule Tile을 이용하여 조금 더 간단히 그릴 수 있다.

<hr>

우선 에셋에서 Create -> 2D -> Tiles -> Rule Tile 파일을 생성한다.

그럼 SO파일이 하나 생기는데, 여기에서 규칙을 설정해줄 수 있다.

가장 우상단에 파일 디렉토리에 표시될 기본 스프라이트를 추가해주고 지정할 규칙의 수 만큼 규칙 수를 지정해준다.

이후 각 규칙에 대응하여 그려질 스프라이트를 지정해준 뒤 규칙을 설정해준다.
[주변 팔방 위치에 타일이 있는경우, 없는경우등을 지정]

저장한 뒤, 타일 팔레트에 해당 SO파일을 등록한 뒤 그리게 된다면 위치에 따라서 규칙에 부합하는 타일들이 그려지게 된다.

<br>

### Animated Tile

타일들은 상황에 따라서 애니메이션을 가질 필요가 있다.
풀, 물 등등...

이럴때 사용할 수 있는 기능이 animated tile이다.

위의 룰 타일과 같은 방식으로 animated tile을 생성한다.

이후 애니메이션될 스프라이트들을 연결하고 애니메이션 간격등을 지정해주면 해당 타일 스프라이트는 애니메이션을 가지게 된다.

<br>