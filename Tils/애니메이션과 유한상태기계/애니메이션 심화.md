# 애니메이션 구현 심화

애니메이션을 구현하는 기본은 살펴봤다.
물론 애니메이션을 직접 깊게 다루지는 않겠지만
기본적인 기능을 사용하는데 유용한 도구들을 알아보자.

<br>

## 애니메이션의 분리?

총을 쏘는 게임을 상상해보자.

우리는 앞으로 걷는 애니메이션과 총을 쏘는 애니메이션을 가지고있다.

다만, 총을 쏘는 애니메이션은 서있는 상태를 기본으로 하고있기 때문에 총을 쏠 때에는 멈춰있을수밖에 없다.

하지만 총을 쏠때에는 멈춰야하는 게임이 인기가 있을리가 없다.

그렇다고 모든 조합마다 애니메이션을 만들기에는 애니메이터가 갈려나갈 것이다.

그렇다면 대체 이 문제를 어떻게 해결해야 할까?

<br>

### 애니메이션의 분리

총을 쏠때에는 하반신 애니메이션은 필요가 없다.

걸으면서 쏜다는 애니메이션은 하반신을 움직이게 하고 상반신을 총을 쏘는 애니메이션을 실행시키면 된다.

이런 방식의 애니메이션 분리 기능을 유니티에서는 아바타 마스크를 이용하여 구현할 수 있다.

<br>

### 아바타 마스크

유니티에서는 avatar mask라는 형식의 파일을 만들 수 있다.

새로운 아바타 마스크파일을 만든 뒤 애니메이션을 표현할 영역만 선택한 뒤 저장하면 된다.

<br>

### 레이어의 분리

기본적으로 사용하는 컨트롤러의 레이어는 모든 몸통을 사용하는 레이어로 설정되어 있다.

따라서 아바타 마스크를 사용한 애니메이션을 사용하려면 새로운 레이어를 만들 필요가 있다.

그 후, 만들어놓은 마스크를 적용하면 해당 부분만 애니메이션이 플레이되는 애니메이터 레이어를 만들수 있다.

<br>

### 레이어의 가중치

분리된 레이어들에는 각각 가중치를 줄 수 있다.

동작하는 부분이 겹치는 경우, 애니메이션의 가중치의 평균치의 애니메이션을 재생시킨다.

<br>

## 블랜드 트리

지금까지 배운 애니메이션 출력 방식은 트리거에 따라 전이하며 해당 애니메이션을 출력하는 방식이었다.

하지만, float등을 전이의 트리거로 이용한다면 모아니면 도 방식으로 딱딱하게 애니메이션 출력이 이뤄질 것이다.

3부터 달리기 시작하는데
3이었다가 3.0000001이 된 순간 달리게 된다면
문제는 없지만 조금 어색할 것이다.

이런 현상을 조금 자연스럽게 만들수는 없을까?

<br>

### 애니메이션 섞기

컨트롤러에 애니메이션을 바로 가져오는 방식으로 노드를 구성했었다. 하지만 바로 노드를 생성할 수도 있는데 여기서 **블랜드 트리**라는것을 만들수 있다.

<hr>

`정지, 걷기, 뛰기` 세가지 애니메이션을 섞어보도록 하자.

블랜드 트리를 하나 만들고 정지, 걷기, 뛰기 애니메이션을 순서대로 넣어준다.

기준이 될 파라미터(float)를 넣어주고
Threshold와 배속을 조정할 수 있으며
파라미터 수치에 따라서 자연스러운 동작을 출력하게 된다.

automate threshold를 체크 해제하면 0~1사이뿐만 아닌 전체 실수 영역에서도 설정할 수 있다.

<br>

## 역 운동학 (IK)

보통의 애니메이션은 리깅이 되어있다.
하지만 해당 리깅의 구조는 부모 자식 관계로 되어있는게 당연한 이치다.

그렇게 되면 한가지 맹점이 발생한다.

어깨는 팔을 자식으로 가지고
팔은 손을 자식으로 가진다

그렇다면 외부의 힘에 의해 손이 움직여지게 된다면?

부모는 따라서 옮겨가지 않는다. 즉, 외부의 힘에 의해 자식요소에 이동이 가해진다면, 부모는 그를 따라가지 않아 부자연스러움이 연출될 수 있음을 나타낸다.

이를 위해 IK라는 요소를 코드로 구현해야 할 필요가 있는데, 이는 조금 복잡해지므로 유니티에서 제공하는 패키지를 이용하게 된다.


animation rigging package를 다운받으면 된다.

<br>

### ik 적용

ik의 기본 적용을 위해서는 우선 준비가 필요하다.
//이하 작성중
1. animator가 있는 캐릭터 모

<br>

[
look에 rig 컴포넌트 추가

타겟에 컴포넌트로 등
animation rigging ->

tow bone ik - 두개의 관절 유용
multi in constraint - 어떤 뼈대가 어떤 대상을 바라볼지 지정
뼈대의 앞/위 방향축 지정
뼈대(constraint object)
볼거(source obj)
회전 제한 지

<br>