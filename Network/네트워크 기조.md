# 네트워크 기초

싱글플레이도 재미있지만, 다른사람과 플레이하면 더욱 재미있는것이 게임이다.
이를 위해서는 네트워크 기반 지식과 기술이 필요하다.
네트워크 기본 지식에 대해서 알아보는 시간을 가져보자.

<br>

## 정의

네트워크를 알아보기 전에 각 용어에 대한 기본 정의를 알아보도록 한다.

<br>

### 네트워크

네트워크란, 컴퓨터가 서로의 장치를 그물처럼 연결하고 정보를 주고받는 시스템을 의미한다.

<br>

### 프로토콜

컴퓨터가 정보를 주고받을때에는 0과 1로 이루어진 데이터로 주고받게 된다.
해당 정보들을 올바르게 전달하고 해석하기 위한 일종의 규칙을 의미한다.

<br>

## OSI 7계층

통신 방식과 그에대한 프로토콜은 한두가지가 아니기 때문에 대략적으로도
어느 방식들과 규약이 있는지 알아야 한다.

이러한 국제 통신 규약을  OSI 7계층이라고 부르며, 데이터의 전송 과정을 7개의 계층으로 분류하여 통신 과정을 개념적으로 설명한 것이다.


<br>
### 계층별 역할

1. 물리 계층
데이터가 물리적으로 연결/전송되는 계층. 랜선등의 물리적인 데이터 연결을 의미한다.
단, 100% 물리적인 연결만 의미하는것이 아닌, 집의 컴퓨터와 공유기간 무선 데이터 전송도 물리 계층의 역할이다.

2. 데이터링크 계층
인접한 노드(컴퓨터와 공유기, 공유기와 브릿지, 브릿지와 ISP 등등..)간의 데이터 전송을 제어
물리적인 MAC주소를 기반으로 통신 목적지를 제어.
물리 계층에 기반한 통신 데이터를 근접한 노드로의 전달, 제어한다.

MAC주소를 이용하여 전파 방식으로 퍼지는 데이터를 올바른 기기에만 반응하도록 선별한다.
한쪽의 데이터 송신이 끝날때까지 수신한 다음, 본인의 데이터를 송신하기 시작한다.

최종 목적지가 아닌, 직접적인 다음 위치로의 데이터 전달 역할을 맡는다.

3. 네트워크 계층
데이터 전송을 위한 경로 설정을 담당한다.
목적지의 IP 주소를 이용해 해당 목적지까지 도달하는 최적의 경로를
**라우팅 알고리즘**을 이용하여 찾아내어 설정한다.

라우팅 알고리즘은 얼기설기 얽혀있는 공유기 네트워크 그래프에서 병렬적인 너비우선 탐색 구조를 통해
가장 안정적이고 빠른 경로를 이용하는 알고리즘이다.

그렇다고 모든 엔드포인트에 대한 반응 테이블을 가지고 있을수는 없으니, 큼직한 지역별로 IP를 나누어서
해당 단위로 테이블 목록을 가지고 있게 한다.

4. 트랜스포트(전송) 계층

각 데이터의 신뢰성을 담당. 각 데이터의 패킹, 해석, 분할등의 역할을 담당하며,
tpc 또는 udp등의 프로토콜 규약에 따라서 데이터 무결성 확인, 재전송 요청등의 행동을 한다.

하나의 기기 내부의 여러가지 프로그램이 열려있을 때, 어느 프로그램으로 데이터를 전달할지 구분하기
위하여 Port라는 식별 번호를 이용한다.

5. 세션 계층

두 장치간의 연결 상태를 관리한다.
한번 연결된 상태라면 다시 연결할 필요가 없으므로 하나의 세션이면 된다.
즉, 여러개의 기기, 프로그램과 연결하려면 여려개의 세션이 필요하다는 의미이며
통신이 끝났다면 세션을 종료시킬 필요가 있다.

이러한 세션들을 관리하는것이 세션 계층의 역할이다.

6. 표현 계층

텍스트, 이미지등의 데이터등을 전송할 수 있는 형태로 변환하는 인코딩/디코딩등의 행위,
비밀번호등의 민감정보등의 암호화/복호화, 전송,수신한 데이터들의 압축/해제등의 데이터 가공 역할을 한다.

7. 응용(애플리케이션) 계층

받은 데이터를 용도에 맞게 사용하여 사용자에게 보여주는 역할을 한다.

<br>

## 데이터 통신 방식

서로 데이터를 주고받는 방식은 한 종류가 아니다.
어떤 방식이고, 어떤 차이점이 있는지 알아보자.

<br>

### 회선 교환방식

두 사용자 사이에 하나의 통신 경로를 지정해주는 방식이다.
직관적이고 확실한 방식이긴 하지만, 동시에 여러 사용자와의 통신이 불가능하며
이미 사용중인 회선은 다른 통신에서 사용할 수 없다는 단점이 있다.

<br>

### 패킷 교환 방식

데이터를 여러개의 작은 데이터 단위인 **패킷**으로 쪼개어 각 패킷을 전송할 때마다
가장 효율적인 경로로 동시다발적으로 데이터를 전송하고, 도착지에서 패킷들을 재조립하는 방식.

<hr>

### 패킷

각 패킷은 쪼개진 상태이기때문에 조립을 위해서 추가 정보가 필요하다.
이러한 이유로 패킷은 부가정보 영역인 **해더** 부분과 실질적인 **데이터** 부분으로 구성된다.

또한, 각 계층별로 필요한 정보가 다르므로 해더 데이터는 계층을 통과할때마나 계속해서 추가되어 붙고,
도착한 경우에는 역순으로 헤더가 하나씩 제거되며 후처리가 이루어져 최종적으로는 데이터만 남게 된다.

<br>

## TCP와 UDP

네트워크 이론에 대해서는 알았다. 그렇다면 현재 실제로 사용되는 프로토콜은 무엇이 있을까?

<br>

### 전송 계층에서의 연결

전송 계층은 규약에 따라 데이터를 가공하는 계층이라고 했다.
따라서 어느 전송 규약을 채택하느냐에 따라서 데이터 구조가 달라지게 된다.

현재 네트워크에서 사용되는 전송 규약에는 TCP와 UDP 두 종류가 있다.

<br>

### TCP(Transmission Control Protocol)

TCP방식의 특징은 다음과 같다.
- 파일이 확실하게 전달받았는지 확인받는다.

이러한 특징때문에 데이터를 하나 전달하는데에도 확인을 받느라 대기시간이 생긴다.
즉, 반드시 신뢰성 있는 정확한 데이터 전달을 보장하지만 전체적인 전송 속도가 느린 편이다.

<br>

### UDP(User Datagram Protocol)

UDP방식의 특징은 다음과 같다.
- 일방적으로 파일을 보내기만 한다.

TCP와 반대로 실시간으로 데이터를 전달받아야 하고, 이에 따른 반응성이 훨씬 중요할 때에는
UDP가 더욱 유리하다. 최소한의 검증만 하고 패킷 유실에 대한 처리가 거의 없기 때문이다.

<br>

## 서버와 클라이언트

멀리서 서버에 접속하기 위해서는 서비스를 제공하는 서버, 플레이어가 사용하는 프로그램인
클라이언트 프로그램이 존재한다.

멀티게임을 구성하기 위해서는 다른 클라이언트의 행동을 볼 수 있어야 하므로 어떤 방식으로든
프로그램들이 연결되어있어야 한다.

프로그램들을 연결하는데에 어떤 방식을 사용할 수 있는지 알아보자.

<br>

### 전용서버(Dedicated Server)[Server - Client]

일반적으로 게임서버라고 하면 떠오르는 서버 구조이다.
게임사 측에서 24시간 작동하는 하나의 서버 전용 컴퓨터를 가지는 단일서버 방식을 의미한다.

반드시 해당 서버에 접속해야만 정상적인 게임 플레이가 가능해지기 때문에 클라이언트간의 직접적인
상호작용이나 간섭이 불가능하다는 특징이 있다.

클라이언트 프로그램은 단순히 입력과 출력을 담당하게 되므로 데이터 위변조에 강하다는 점과 클라이언트의 성능 요구사항이 적다는 장점이 있지만
서버가 모든 연산을 대신하게 되므로 서버에 고성능의 연산능력이 필요하고, 초기 구성 비용이 많이 들게 된다.

또한, 서버와 물리적으로 거리가 멀다면 필연적으로 지연현상이 발생하게 된다.

<br>

### 리슨서버(Listen Server)[Host - Client]

회사가 서버역할을 하는 방식이 아닌, 멀티게임을 플레이하는 구성원들 중 한명이 서버의 역할을 겸임하여(host)
다른 클라이언트들은 호스트에게 연결하여 플레이 환경을 구축하는 방식이다.

클라이언트간의 거리가 짧다면 지연시간이 비교적 최소화될 수 있다는 점과 서버 구축 비용이 들지 않는다는 장점이 있지만,
호스트 역할의 컴퓨터가 버틸 수 있는 성능을 고려하여 프로그램을 작성해야 하며, 호스트의 악의적인 데이터 조작에
취약하다는 단점이 있다.

또한, 호스트 역할을 하는 클라이언트가 연결이 끊어지는 경우, 다른 클라이언트들 간의 연결은 모두 호스트 역할을 하는
클라이언트에 의존하고 있으므로 일괄적으로 연결이 끊어지게 될 것이다.

<br>

### P2P(Peer to Peer)

게임 참여자(클라이언트) 모두가 서버의 역할을 담당하는 구조, 각자 클라이언트들은 다른 모든 클라이언트들과 각자 연결되어있으며
특정 클라이언트에서 본인의 연산이 종료되면 다른 모든 클라이언트들에 연산결과를 전파하는 방식으로
연산을 모든 클라이언트들에게 나누어 부담시키므로 특정 클라이언트에게 연산 부담을 주는 문제를 줄일 수 있다.

또한, 각 클라이언트들은 다른 모든 클라이언트들고 연결되어있는 상태이기 때문에 특정 클라이언트가 연결이 끊어지더라도
남은 클라이언트들끼리 게임 상황을 진행할 수 있다.

다만, 클라이언트가 많아질수록 필요한 네트워크 연결 회선 수가 지수적으로 늘어나기 때문에 실질적으로 p2p방식에서는 보통
최대 접속 가능 클라이언트 수가 제한되어있다.

<br>
